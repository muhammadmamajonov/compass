{% extends 'manba.html' %}
{% load static %}
{% block css %}
    <link rel="stylesheet" href="{% static 'yangi/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'yangi/css/bootstrap-select.css' %}">
    
{% endblock css %}
{% block content %}
<style>
    .reg {
        margin-top: 48px;
    }
    
    .font {
        padding-left: 20px;
    }
    
    .font:focus {
        outline: none;
    }
    
    input {
        border: 1px solid #A6A6A6;
    }
    
    .font button:hover {
        background-color: white;
    }
</style>
                    <div class="container-fluid">
                        <div style="text-align: end;">
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter" style="padding: 1rem; border-radius: 20px; width: 150px; height: 60px; outline: none;  border: 1px solid #0000ff;">
                                Hisobot qoshish
                              </button>
                              <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      <h5 class="modal-title" id="exampleModalLongTitle">Hisobot</h5>
                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                      </button>
                                    </div>
                                    <div class="modal-body">
                                        <form action="{% url 'hisobot' %}" method="post" enctype= "multipart/form-data" style="background-color: #ffffff; border-radius: 43px;" class="col-lg-12 col-md-12 text-center mb-5 reg">
                                            {% csrf_token %}
                                                <div class="row py-5">
                                                    <div class="col-lg-12 col-md-12">
                                                        <textarea name="hisobot" placeholder="Hisobotni yozing" id="floatingTextarea2" style="height: 100%; width: 100%" required></textarea>
                                                    </div>
                                                  </div>
                                                      <div class="row py-3">
                                                          <div class="col-lg-12 col-md-12 qoshish font">
                                                              <button class="btn btn-primary" style="padding: 1rem; border-radius: 30px; width: 200px; outline: none;  border: 1px solid #0000ff;">Topshirish</button>
                                                          </div>
                                                      </div>
                                                  </form>
                                               </div>
                                            <div class="modal-footer">
                                         <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              <div class="text-center">
                        </div>
                    </div>
                <!-- Begin Page Content -->
                <div class="row">
        <form action="" class="ml-5">
            <label for="birthday">Dan:</label>
            <input type="date" id="dan" name="dan">
            <label for="birthday">Gacha:</label>
            <input type="date" id="gacha" name="gacha">
            <button class="ml-3" onclick="hisobotsaralash()" type="button">Saralash</button>
        </form>
        
        <script>
             var i
        function hisobotsaralash() {
            dan = document.getElementById("dan").value
            gacha = document.getElementById("gacha").value
            console.log(dan, gacha)
            var url  = `/dashboard/hisobot_saralash/?dan=`+dan+`&gacha=`+gacha
            $.ajax({
            type: 'GET',
            url: url,
            success: function(data) {
                var datas = data['data'];
                var gt = '';
                var t;
                t = 0
                for (var dt of datas) {
                    id = dt.id;
                    hisobot = dt.hisobot;
                    sana = dt.sana;
                    console.log(dt)
                    console.log(t)
                    t+=1;
                    gt +=
                        `<tr><td>`+ t +`</td>
                        <td><button class="btn btn-link" data-toggle="modal" data-target="#hisobot`+ id +`">`+hisobot + `</button></td>
                        <td>`+ sana +`</td></tr>`
                }

                    document.getElementById("hisobot-jadval").innerHTML = gt;
            }

            
            })
        }
        
        </script>
    </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 col-md-12">
                    <table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                            <th class="th-sm">#
                            </th>
                            <th class="th-sm">Hisobot
                            </th>
                            <th class="th-sm">Sana
                            </th>
                            </tr>
                        </thead>
                        <tbody id='hisobot-jadval'>
                        {% if messages %}
                        {% for message in messages%}
                        {{message}}
                        {% endfor%}
                        {% endif %}
                            {% for hisobot in hisobotlar %}
                            <tr>
                                <td> {{ forloop.counter }}</td>
                                <td><button class="btn btn-link" data-toggle="modal" data-target="#hisobot{{ hisobot.id }}">{{ hisobot.hisobot|truncatewords:3 }}</button></td>
                                <td>{{ hisobot.sana }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

            <!-- End of Main Content -->

                </div>
            <!-- End of Main Content -->
    <div class="modal fade" id="exampleModalm" data-keyboard="false" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ma'lumot</h5>
                </div>
                <div class="modal-body">

                    <ul class="messages">
                        {% for message in messages %}
                            <li style="color: green" class="{{ message.tags }}"><h4>{{ message }}</h4></li>
                        {% endfor %}
                    </ul>

                </div>
                <div class="modal-footer">
                    <a href="{% url 'hisobot' %}"><button type="button" class="btn btn-secondary" >Yopish</button></a>

                </div>
            </div>
        </div>
    </div>
</div>


    <!-- Modal -->
{% for hisob in hisobotlar %}
<div class="modal fade" id="hisobot{{ hisob.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel">Hisobot</h5>
                    </div>
                        <div class="modal-body">
                           <p>{{ hisob.hisobot }}</p>
                        </div>

                  </div>
                </div>
            </div>
{% endfor %}

{% endblock content %}
{% block js %}
{% for message in messages %}
    {% if message.tags == "info" %}
    <script>
    $(document).ready(function() {
        $('#exampleModalm').modal({
            show: true
        });
    });
    </script>
{% endif %}
{% endfor %}
  
    <script src="{% static 'yangi/js/bootstrap-select.js' %}"></script>
    <script src="{% static 'yangi/js/bootstrap-select.min.js' %}"></script>
{% endblock js %}