{% extends 'manba_oqituvchi.html' %} {% load static %} {% block css %}
<!-- Custom styles for this page -->
<!--<link href="{% static 'yangi/vendor/datatables/dataTables.bootstrap4.min.css' %}" rel="stylesheet">-->{% endblock css %} {% block content %}


<!-- Begin Page Content -->
<!-- <div id="card" class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Davomat ro'yxati</h6>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>T</th>
                        <th>Ism-Familya</th>
                        <th>Guruh</th>
                        <th>Sana</th>
                        <th>Keldi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for davomat in davomat_royxat %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ davomat.talaba.ism_familya }}</td>
                        <td>{{ davomat.guruh.nomi }}</td>
                        <td>{{ davomat.sana }}</td>
                        {% if davomat.keldi == 1 %}
                        <td><img src="{% static 'yangi/img/plus.svg' %}"></td>
                        {% else %}
                        <td><img src="{% static 'yangi/img/minus.svg' %}"></td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>


</div> -->

<div class="container-fluid">
    <!-- DataTables Example -->
    <div id="card" class="card shadow mb-4">
        <div class="card-header py-3">
            <div class="dropdown">
                <button class="btn dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Guruhlar</button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    {% for guruhi in guruhlari %}
                    <form action="{% url 'guruh-d' %}" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="guruh_id" value="{{guruhi.id}}">
                        <button type="submit" class="btn btn-link">{{ guruhi.nomi }}</button> <br></form> {% endfor %}

                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">


                <table class="table table-bordered" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>T</th>
                            <th>Ism-Familya</th>
                            <th>Guruh</th>
                            <th>Telefon</th>
                            <th>Bu oy qoldirgan dars</th>
                            <th>Keldi</th>
                        </tr>
                    </thead>
                    <tbody id="guruh_talabalar">
                        <form action="{% url 'davomat' %}" method="POST">
                            {% csrf_token %} {% for talaba in guruh_t %}
                            <tr>
                                <td>{{forloop.counter}}</td>
                                <td> <button type="button" class="btn btn-link" data-toggle="modal" data-target="#oquvchi_davomatModal{{talaba.id}}">{{talaba.ism_familya}}</button></td>
                                <td>{{talaba.guruh}}</td>
                                <td>{{talaba.telefon}}</td>
                                <td>{{talaba.qoldirgan}}</td>
                                <td><input class="ml-2" type="checkbox" name="bor-yoq" value="{{talaba.id}}"></td>
                            </tr>
                            {% endfor %}
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>

                                <td></td><input type='hidden' name="gur_id" value="{{guruh.id}}">
                                <td> <input class="btn btn-outline-primary" type="submit" value="davomat"></td>
                            </tr>
                        </form>
                    </tbody>
                </table>

            </div>
        </div>

    </div>

</div>

<div class="modal fade" id="exampleModal" data-keyboard="false" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Xabar</h5>
            </div>
            <div class="modal-body">

                <ul class="messages">
                    {% for message in messages %}
                    <li style="color: black" class="{{ message.tags }}">{{ message }}</li>
                    {% endfor %}
                </ul>

            </div>
            <div class="modal-footer">
                <a href="{% url 'kutayotganlar' %}"><button type="button" class="btn btn-secondary" >Yopish</button></a>

            </div>
        </div>
    </div>
</div>

<!-- O'quvchi davomat modal -->

{% for azo in guruh.azolik_set.all %}
<div class="modal fade" id="oquvchi_davomatModal{{azo.talaba.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">{{azo.talaba.ism_familya}}</h5>

            </div>
            <div class="modal-body">

                <ul class="messages">
                    <table class="table table-bordered" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>T</th>
                                <th>Guruh</th>
                                <th>Sana</th>
                                <th>Keldi</th>
                            </tr>
                        </thead>
                        <tbody id="guruh_talabalar">
                            {% for davomat in azo.talaba.davomat_set.all %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ davomat.guruh.nomi }}</td>
                                <td>{{ davomat.sana }}</td>
                                {% if davomat.keldi %}
                                <td><img style="width: 30px;" src="{% static 'yangi/img/checked.svg' %}"></td>
                                {% else %}
                                <td><img style="width: 30px;" src="{% static 'yangi/img/cancel.svg' %}"></td>
                                {% endif %}
                            </tr>
                            {% endfor %}

                        </tbody>
                    </table>
                </ul>

            </div>
            <div class="modal-footer">


            </div>
        </div>
    </div>
</div>
{% endfor %}

<script>
    var i

    function guruhtalaba(id) {
        i = id
        $.ajax({
            type: 'GET',
            url: "/dashboard/guruh-talabalari/",
            data: {
                i: i
            },
            success: function(data) {
                var datas = data['data'];
                var gt = '';
                i = 0;
                console.log(datas)

                for (var dt of datas) {
                    ism = dt.ism;
                    id = dt.id;
                    guruh = dt.guruh;
                    guruh_id = dt.guruh_id;
                    tel = dt.tel;
                    tolov = dt.tolov;
                    manzil = dt.manzil;
                    i = i + 1;
                    gt +=
                        ` 
                    <tr>
                        <td>` + i + `</td>
                        <td> <button type="button" class="btn btn-link"  data-toggle="modal" data-target="#oquvchi_davomatModal` + id + `">` + ism + `</button></td>
                        <td>` + guruh + `</td>
                        <td>` + tel + `</td>
                        <td><input class="ml-2" type="checkbox" name="bor-yoq" value="` + id + `"></td>
                    </tr>`;
                }

                gt += `<tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td> <input class="btn btn-outline-primary" type="submit" value="davomat" ></td>
                    <input type='hidden' name="gur_id" value="` + guruh_id + `"
                    </tr>
                   
                    `;
                console.log(gt)
                document.getElementById("guruh_talabalar").innerHTML = gt;
            }
        })
    }
</script>
{% endblock content %} {% block js %}
<!-- Page level plugins -->
<!-- <script src="{% static 'yangi/vendor/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'yangi/vendor/datatables/dataTables.bootstrap4.min.js' %}"></script> -->

<!-- Page level custom scripts -->
<!-- <script src="{% static 'yangi/js/demo/datatables-demo.js' %}"></script> -->
{% if messages %}
<script>
    $(document).ready(function() {
        $('#exampleModal').modal({
            show: true
        });
    });
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="{% static 'yangi/js/guruh_talabalari.js' %}"></script>
{% endif %} {% endblock js %}